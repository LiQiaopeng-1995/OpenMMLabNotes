# OpenMMLab-AIè®­ç»ƒè¥-2

å›¾åƒåˆ†ç±»ä¸Ž MMClassification

## 1. å›¾åƒåˆ†ç±»

**ä»»åŠ¡ç›®æ ‡: ç»™å®šä¸€å¼ å›¾ç‰‡, è¯†åˆ«å›¾åƒä¸­çš„ç‰©ä½“æ˜¯ä»€ä¹ˆ.**

### 1.1 æ•°å­¦è¡¨ç¤º

å›¾åƒæ˜¯åƒç´ æž„æˆçš„HWCæ•°ç»„, è¾“å‡ºç±»åˆ«ä¸º$yâˆˆ{1, ..., K}$çš„å‘é‡.  
æž„å»ºå‡ºä¸€ä¸ªå¯è®¡ç®—å®žçŽ°çš„å‡½æ•°$F: R^{H*W*C}-{1, ..., K}$, ä¸”é¢„æµ‹ç»“æžœç¬¦åˆäººç±»è®¤çŸ¥.

### 1.2 ä¼ ç»Ÿæœºå™¨å­¦ä¹ çš„éš¾ç‚¹

1. æ”¶é›†æ•°æ®;
2. å®šä¹‰æ¨¡åž‹:
é€šå¸¸ä¸ºå«å‚å˜é‡çš„å‡½æ•°: $y = F_{\theta}(X)$;
3. è®­ç»ƒ:
å¯»æ‰¾æœ€ä½³å‚æ•°$\theta^*$, ä½¿å¾—æ¨¡åž‹$y = F_{\theta^*}(X)$åœ¨è®­ç»ƒé›†ä¸Šè¾¾åˆ°æœ€ä½³æ­£ç¡®çŽ‡;
4. é¢„æµ‹:
å¯¹äºŽæ–°å›¾åƒ$\overline{X}$, ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡åž‹æ¥é¢„æµ‹å…¶ç±»åˆ«, $\overline{Y}=F_{\theta^*}(\overline{X})$.

æœºå™¨å­¦ä¹ çš„å±€é™:  
æœºå™¨å­¦ä¹ å–„äºŽå¤„ç†ä½Žç»´, åˆ†å¸ƒç›¸å¯¹ç®€å•çš„æ•°æ®; è€Œå›¾åƒæ•°æ®åœ¨æžé«˜ç»´çš„ç©ºé—´ä»¥å¤æ‚çš„æ–¹å¼"çº ç¼ "åœ¨ä¸€èµ·, æœºå™¨å­¦ä¹ éš¾ä»¥å¤„ç†å¤æ‚æ•°æ®åˆ†å¸ƒ.  

ä¼ ç»Ÿæ–¹æ³•: æ‰‹åŠ¨è®¾è®¡å›¾åƒç‰¹å¾;  
ç‰¹å¾å­¦ä¹ : å­¦ä¹ å¦‚ä½•äº§ç”Ÿé€‚åˆåˆ†ç±»çš„ç‰¹å¾, å¤šä¸ªç®€å•ç‰¹å¾å˜æ¢å¤åˆæž„æˆä¸€ä¸ªå¤æ‚çš„ç«¯åˆ°ç«¯åˆ†ç±»å™¨;  

### 1.3 åŸºäºŽæ¨¡åž‹çš„å›¾åƒåˆ†ç±»

1. æ¨¡åž‹è®¾è®¡: è®¾è®¡é€‚åˆå›¾åƒçš„F~Î¸~(X).
   1. å·ç§¯ç¥žç»ç½‘ç»œ;
   2. è½»é‡åŒ–å·ç§¯ç¥žç»ç½‘ç»œ;
   3. ç¥žç»ç»“æž„æœç´¢;
   4. Transformer;
2. æ¨¡åž‹å­¦ä¹ : æ±‚è§£ä¸€ç»„å¥½çš„å‚æ•°~Î¸~.
   1. ç›‘ç£å­¦ä¹ : åŸºäºŽæ ‡æ³¨æ•°æ®å­¦ä¹ 
      1. æŸå¤±å‡½æ•°;
      2. éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•;
      3. è§†è§‰æ¨¡åž‹å¸¸ç”¨è®­ç»ƒæŠ€å·§
   2. è‡ªç›‘ç£å­¦ä¹ : åŸºäºŽæ— æ ‡æ³¨çš„æ•°æ®å­¦ä¹ .

### 1.4 å·ç§¯ç¥žç»ç½‘ç»œ

1. AlexNet(2012): å¼€å±±ä¹‹ä½œ.  
   ä½¿ç”¨äº†å·ç§¯å±‚å’Œå…¨è¿žæŽ¥å±‚; ä½¿ç”¨ReLUå¤§å¹…æé«˜æ”¶æ•›é€Ÿåº¦; å®žçŽ°å’Œå¼€æºäº†cuda-convert, èƒ½åœ¨GPUä¸Šè®­ç»ƒ;
2. å‘å±•(2012~2014): æå‡å±‚æ•°.
   1. VGG-19:  
    ç”¨å¤šå±‚3x3çš„å·ç§¯å±‚ä»£æ›¿å¤§å°ºå¯¸å·ç§¯, å¸¦æ¥æ›´å°‘çš„å‚æ•°é‡,æ›´å¤šçš„å±‚æ•°å’Œè¡¨è¾¾èƒ½åŠ›;  
    æ¯éš”å‡ å±‚å€å¢žé€šé“æ•°ã€å‡åŠåˆ†è¾¨çŽ‡, ç”Ÿæˆ1/2ã€1/4å°ºåº¦çš„æ›´é«˜æŠ½è±¡å±‚æ¬¡ç‰¹å¾, æ–¹ä¾¿åœ¨ä½ç½®æ•æ„Ÿçš„ä¸‹æ¸¸ä»»åŠ¡, å¦‚æ£€æµ‹ã€åˆ†å‰²ä¸­ä½¿ç”¨.  
    è¿™å°±æ˜¯æ‰€è°“çš„backbone, ç”¨äºŽæå–ç‰¹å¾.
   2. GoogleLeNet:  
    ä½¿ç”¨Inceptionæ¨¡å—å †å å½¢æˆ, æœ€ç»ˆçš„åˆ†ç±»ä»…ä½¿ç”¨å•å±‚å…¨è¿žæŽ¥å±‚, å¯èŠ‚çœå¤§é‡å‚æ•°, ä»…7Mæƒé‡å‚æ•°.  
3. æ®‹å·®ç½‘ç»œ(2015)
   1. ç²¾åº¦é€€åŒ–é—®é¢˜: æ¨¡åž‹å±‚æ•°å¢žåŠ åˆ°ä¸€å®šç¨‹åº¦åŽ, åˆ†ç±»æ­£ç¡®çŽ‡ä¸å¢žåé™;
   2. çŒœæƒ³: å¸¸è§„ä¼˜åŒ–ç®—æ³•éš¾ä»¥æ‰¾åˆ°ç†è®ºä¸Šæ›´é«˜ç²¾åº¦çš„æ¨¡åž‹, è®©æ–°å¢žçš„å·ç§¯å±‚æ‹Ÿåˆè¿‘ä¼¼æ’ç­‰æ˜ å°„, èƒ½æå‡æµ…å±‚ç½‘ç»œçš„æ€§èƒ½;
   3. æ•°å­¦è¡¨è¾¾:
      1. æµ…å±‚ç½‘ç»œ: $y = F_{\theta}(X)$;
      2. æ·±å±‚ç½‘ç»œ: $y = g_\theta(F_{\theta}(X))$;
      3. æ®‹å·®ç½‘ç»œ: $y = (I + g_\theta)(F_{\theta}(X))$;
   4. ResNetä¸­çš„ä¸¤ç§æ®‹å·®æ¨¡å—:
      ![ResNet Module](image/OpenMMLabNote-2/ResNet.png "ResNet Module")
4. ç¥žç»ç»“æž„æœç´¢ Neural Architecture Search (2016+)
   1. åŸºæœ¬æ€è·¯: å€ŸåŠ©å¼ºåŒ–å­¦ä¹ ç­‰æ–¹æ³•æœç´¢å‡ºè¡¨çŽ°æœ€ä½³çš„ç½‘ç»œ;
   2. ä»£è¡¨ä½œ: NASNet(2017), MnasNet(2018), EfficientNet(2019), RegNet(2020);
5. Vision Transformers: ä½¿ç”¨NLPä¸­çš„Transformerä»£æ›¿CNN, ç²¾åº¦æ›´é«˜
   1. ä»£è¡¨ä½œ: Vision Transformer(2020), Swin-Transformer(2021 ICCV æœ€ä½³è®ºæ–‡);

### 1.5 è½»é‡åŒ–å·ç§¯ç¥žç»ç½‘ç»œ

#### 1.5.1 å·ç§¯å‚æ•°é‡å’Œè®¡ç®—é‡

1. è¾“å…¥ç‰¹å¾å›¾$X \in R^{H*W*C}$;
2. è¾“å‡ºç‰¹å¾å›¾$Y \in R^{H'*W'*C'}$;
3. $C'$ ä¸ª$C$ é€šé“çš„å·ç§¯æ ¸$K \in R^{C'*K*K*C}$;
4. $C'$ ä¸ªåç½®å€¼$b \in R^{C'}$.

- å·ç§¯å±‚è®­ç»ƒå‚æ•°: å·ç§¯æ ¸å’Œåç½®å€¼;
- å‚æ•°é‡$M=C'*(C*K*K+1)=C'CK^2+C'$;
- è¾“å‡ºç‰¹å¾å›¾çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯è¾“å…¥ç‰¹å¾å›¾å’Œ1ä¸ªå·ç§¯æ ¸è¿›è¡Œå·ç§¯çš„ç»“æžœ;
- è®¡ç®—é‡$N=H'*W'*C'*(C*K*K)=H'W'C'CK^2$.
- è¾“å‡ºç‰¹å¾å›¾å…ƒç´ ä¸ªæ•°xå•ä¸ªå…ƒç´ å’Œå•ä¸ª$C*K*K$çš„å·ç§¯æ ¸ä¹˜åŠ æ¬¡æ•°.

#### 1.5.2 è½»é‡åŒ–æ–¹æ³•

åŸºæœ¬æ€è·¯:

1. é™ä½Žé€šé“æ•°Cå’ŒC'(å¹³æ–¹çº§åˆ«);
2. å‡å°‘å·ç§¯æ ¸å°ºå¯¸K(å¹³æ–¹çº§åˆ«);

ç¤ºä¾‹:

1. GoogLeNet ä½¿ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸;
2. ResNetä½¿ç”¨1x1çš„å·ç§¯åŽ‹ç¼©é€šé“æ•°;
3. MobileNetä½¿ç”¨å¯åˆ†ç¦»å·ç§¯,å°†å¸¸è§„å·ç§¯åˆ†è§£ä¸ºé€å±‚å·ç§¯å’Œé€ç‚¹å·ç§¯;
   1. 32ä¸ª3é€šé“çš„3x3å·ç§¯æ ¸->3ä¸ªå•é€šé“çš„3x3å·ç§¯æ ¸ + 32ä¸ª1x1çš„å·ç§¯æ ¸;

### 1.6 Transformer

#### 1.6.1 æ³¨æ„åŠ›æœºåˆ¶

åŽŸç†: æ¯”èµ·å·ç§¯æ ¸, æ˜¾å¼å»ºæ¨¡è¿œè·ç¦»å…³ç³», å‡½æ•°å’Œè¾“å…¥ç›¸å…³è”.  
å¼•å…¥äº†ä¸€ä¸ª$W_query$, å’Œ$W_key$æ¥è®¡ç®—æœ€ç»ˆçš„Weight.

TODO: å›¾ç¤ºå’Œæ•°å­¦å…¬å¼, é˜…è¯»"Attention is all you Need".

#### 1.6.2 Swin Tranformerçš„ä¼˜åŒ–

1. ä½¿ç”¨åˆ†å±‚ç»“æž„(é‡‘å­—å¡”ç»“æž„)æ¥èŽ·å¾—å±‚æ¬¡åŒ–ç‰¹å¾;
2. å°†ç‰¹å¾å›¾åˆ†å—, åœ¨å—å†…è¿›è¡Œå¤šå¤´æ³¨æ„åŠ›è®¡ç®—, é™ä½Žè®¡ç®—é‡;
3. åœ¨ä¸‹ä¸€å±‚å¯¹Windowsåšåç§», è·¨çª—å£ä¼ é€’ä¿¡æ¯;
4. é‡å¤å †å Swin Transformer Block;

### 1.7 æ¨¡åž‹å­¦ä¹ 

#### 1.7.1 ç›‘ç£å­¦ä¹ 

##### 1.7.1.1 éšæœºæ¢¯åº¦ä¸‹é™(SGD)

   1. éšæœºåˆå§‹åŒ–å‚æ•°;
   2. è¿­ä»£åˆ°æ”¶æ•›:
      1. é€‰å–æ•°æ®é›†, è®¡ç®—è¿‘ä¼¼æŸå¤±;
      2. å‰å‘+åå‘ä¼ æ’­, è®¡ç®—æ¢¯åº¦;
      3. æ›´æ–°å‚æ•°;

##### 1.7.1.2 æƒé‡åˆå§‹åŒ–

- éšæœºåˆå§‹åŒ–:
  - ä½¿ç”¨å‡åŒ€åˆ†å¸ƒæˆ–é«˜æ–¯åˆ†å¸ƒ;
  - Xavieræ–¹æ³•:
  - Kaimingæ–¹æ³•:
- ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡åž‹å‚æ•°;

##### 1.7.1.3 è°ƒæ•´å­¦ä¹ çŽ‡

å­¦ä¹ çŽ‡é€€ç«: ç­‰æŸå¤±å‡½æ•°ç¨³å®šåŽä¸‹é™å­¦ä¹ çŽ‡;  
å­¦ä¹ çŽ‡å‡æ¸©: åœ¨è®­ç»ƒå‰å‡ è½®å­¦ä¹ çŽ‡é€æ¸ä¸Šå‡, ç›´åˆ°é¢„è®¾çš„å­¦ä¹ çŽ‡, ä»¥ç¨³å®šè®­ç»ƒçš„åˆå§‹é˜¶æ®µ;  
æ—©åœ: å°†è®­ç»ƒæ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†, åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒ, å‘¨æœŸæ€§åœ¨éªŒè¯é›†ä¸Šæµ‹è¯•åˆ†ç±»ç²¾åº¦; å½“éªŒè¯é›†çš„åˆ†ç±»ç²¾åº¦ è¾¾åˆ°æœ€å€¼æ—¶, åœæ­¢è®­ç»ƒ, é˜²æ­¢è¿‡æ‹Ÿåˆ;
æ¨¡åž‹æƒé‡å¹³å‡: EMAå’ŒStochastic Weight Averaging.è®¤ä¸ºæ¨¡åž‹åœ¨ä¼˜åŒ–æœ«æœŸä¼šåœ¨æžå°å€¼å‘¨å›´"è½¬åŠ¨", å¹³å‡å‚æ•°æ›´æŽ¥è¿‘æžå°å€¼ç‚¹;  

#### æ•°æ®å¢žå¼º

é€šè¿‡ä¸€äº›æ–¹æ³•æ‰©å……è®­ç»ƒæ•°æ®é›†:

1. å‡ ä½•å˜æ¢, è‰²å½©å˜å¹», éšæœºé®æŒ¡;
2. ç»„åˆä¸Šè¿°å˜æ¢;
3. å¯¹è®­ç»ƒé›†çš„å›¾åƒé—´è¿›è¡Œç»„åˆ(å‡è®¾å›¾åƒç‰¹å¾ä¸ä¼šå‘ç”Ÿå¤§å˜åŒ–);
4. æ ‡ç­¾å¹³æ»‘: æé«˜æ³›åŒ–æ€§;

#### æ¨¡åž‹ç›¸å…³ç­–ç•¥

1. ä¸¢å¼ƒå±‚ Dropout: è®­ç»ƒæ—¶éšæœºä¸¢å¼ƒä¸€äº›è¿žæŽ¥, ç ´åç¥žç»å…ƒä¹‹é—´çš„å…³è”, é˜²æ­¢å‡ºçŽ°å…±é€‚åº”çŽ°è±¡å¯¼è‡´è¿‡æ‹Ÿåˆ, é¼“åŠ±å­¦ä¹ ç‹¬ç«‹çš„ç‰¹å¾;
2. éšæœºæ·±åº¦ Stochastic Depth: ResNet. åˆ©ç”¨ä¸åŒçš„æ·±åº¦è®­ç»ƒ, æœ€ç»ˆç›¸å½“äºŽæ½œåœ¨åœ°èžåˆäº†å¤šä¸ªä¸åŒæ·±åº¦çš„ç½‘ç»œ, æå‡äº†æ€§èƒ½;

#### 1.7.2 è‡ªç›‘ç£å­¦ä¹ 

##### 1.7.2.1 åŸºæœ¬æ¦‚å¿µ

åŸºæœ¬å‡è®¾: å›¾ç‰‡å†…å®¹çš„ç‰¹å¾å¯ä»¥ååº”å‡ºå›¾ç‰‡çš„åˆ†ç±»ä¿¡æ¯.

1. é€šè¿‡æ°å½“è®¾è®¡è¾…åŠ©ä»»åŠ¡, è®©æ¨¡åž‹åœ¨æ— æ ‡æ³¨æ•°æ®é›†$Dâ€²={ð‘‹_iâ€²}^ð‘_{i=1}$ ä¸Šå­¦ä¹ å¥½çš„ç‰¹å¾;
2. å†æŠŠæ¨¡åž‹æ”¾åœ¨ä¸€ä¸ªç›¸å¯¹å°çš„æ ‡æ³¨æ•°æ®é›†ä¸Šè®­ç»ƒåˆ†ç±»;

è¾…åŠ©ä»»åŠ¡:

1. åŸºäºŽä»£ç†ä»»åŠ¡;
2. åŸºäºŽå¯¹æ¯”ä»»åŠ¡;
3. åŸºäºŽæŽ©ç å­¦ä¹ ;

##### 1.7.2.2 ç¤ºä¾‹

1. Relative Location (ICCV 2015)  
åŸºæœ¬å‡è®¾: æ¨¡åž‹åªæœ‰å¾ˆå¥½åœ°ç†è§£åˆ°å›¾ç‰‡å†…å®¹, æ‰èƒ½å¤Ÿé¢„æµ‹å›¾åƒå—ä¹‹é—´çš„å…³ç³».  
![Relative Location](image/OpenMMLabNote-2/Relative_Location.png "Relative Location")

2. SimCLR (ICML 2020)  
åŸºæœ¬å‡è®¾: å¦‚æžœæ¨¡åž‹èƒ½å¾ˆå¥½åœ°æå–å›¾ç‰‡å†…å®¹çš„æœ¬è´¨, é‚£ä¹ˆæ— è®ºå›¾ç‰‡ç»è¿‡ä»€ä¹ˆæ ·çš„æ•°æ®å¢žå¼ºæ“ä½œ, æå–å‡ºæ¥çš„ç‰¹å¾éƒ½åº”è¯¥æžä¸ºç›¸ä¼¼.  
å¯¹äºŽæŸç§å›¾ç‰‡$ð‘¥$, å¯¹å®ƒè¿›è¡Œä¸¤æ¬¡æ•°æ®å¢žå¼º, å¾—åˆ°$ð‘¥_1$å’Œ$ð‘¥_2$  
   - $ð‘¥_1$å’Œ$ð‘¥_2$äº’ä¸ºæ­£æ ·æœ¬;  
   - å…¶ä»–å›¾ç‰‡çš„å¢žå¼ºç»“æžœéƒ½æ˜¯$ð‘¥_1$å’Œ$ð‘¥_2$çš„è´Ÿæ ·æœ¬;  
è®­ç»ƒæ—¶æŽ¨è¿œè´Ÿæ ·ä¹‹é—´çš„ç‰¹å¾è·ç¦», æ‹‰è¿‘æ­£æ ·æœ¬çš„ç‰¹å¾è·ç¦».

3. Masked autoencoders (MAE, CVPR 2022)  
åŸºæœ¬å‡è®¾: æ¨¡åž‹åªæœ‰ç†è§£å›¾ç‰‡å†…å®¹ã€æŽŒæ¡å›¾ç‰‡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯, æ‰èƒ½æ¢å¤å‡ºå›¾ç‰‡ä¸­è¢«éšæœºé®æŒ¡çš„å†…å®¹.  

#### å›¾åƒåˆ†ç±»æ¨¡åž‹æž„æˆ

```mermaid
graph LR
   A[æ•°æ®] --> B[backboneéª¨å¹²ç½‘ç»œ<br>ResNet]
   B--ç‰¹å¾å›¾--> C[necké¢ˆéƒ¨<br>Global Average Poolingå±‚]
   C--ç‰¹å¾å‘é‡--> D[åˆ†ç±»å¤´<br>å…¨è¿žæŽ¥å±‚+Softmax]
```
